<!DOCTYPE html>
<html>
<head>
<script src="blockly_compressed.js"></script>
<script src="blocks_compressed.js"></script>
<script src="javascript_compressed.js"></script>
<script src="msg/js/en.js"></script>
<script src="blocks/tpblock.js"></script>
<script src="blocks/tpblock_extractor.js"></script>
<script src="generators/javascript/tpblock.js"></script>
<script src="../closure-library/closure/goog/base.js"></script>

 <meta charset="utf-8">
<title>Blockly Testing</title>
<style type="text/css">
#blocklyDiv {
  height: 960px;
}
</style>
</head>
<body>
  <button id="gen">Generate</button>
 <div id="blocklyDiv" ></div>

  <script>
    var gen = document.getElementById('gen');
    var blocklyDiv = document.getElementById('blocklyDiv');
    var workspace = Blockly.inject(blocklyDiv
        // {toolbox: document.getElementById('toolbox')}
        );
    window.addEventListener('resize', onresize, true);
    Blockly.svgResize(workspace); 

    var xmlInit = '<xml xmlns="http://www.w3.org/1999/xhtml"><block type="extractor" id="D-i{Q5j{]PJ!5f.@f^S^" deletable="false" x="195" y="107"><value name="line"><block type="delimiter" id="Ac+pjF7~c!4aIPbI+wZ)"><field name="delim">3</field><value name="next_marker"><block type="field_extractor" id="O=YTnW5cO}VG9vq~DzF-"><field name="NAME">1</field><field name="operation">string</field><field name="VAR">string2</field></block></value></block></value><next><block type="transform" id="`#{siG=4Z=W{9fzG7~Xj" deletable="false"><next><block type="store" id="x6tnR`YVMw61kvdnf}`B" deletable="false"><mutation items="2"></mutation><field name="operation">hdfs</field><field name="headers">TRUE</field></block></next></block></next></block></xml>';

                 var xmlDom = Blockly.Xml.textToDom(xmlInit);
                Blockly.Xml.domToWorkspace(Blockly.mainWorkspace, xmlDom);

    gen.addEventListener('click', function() {
      Blockly.JavaScript.variables = [];
      Blockly.JavaScript.extractPhase = '';
      Blockly.JavaScript.translatePhase = '';
      Blockly.JavaScript.storePhase = '';
      Blockly.JavaScript.initFunctions = [];
      Blockly.JavaScript.workspaceToCode(Blockly.getMainWorkspace());
      var output ='';
      output+= "Variables\n";
      output+= "--------------------\n";
      output+= Blockly.JavaScript.variables.join('\n')+'\n';
      output+= "--------------------\n";
      output+= "Inits\n";
      output+= "--------------------\n";
      output+= Blockly.JavaScript.initFunctions.join('\n')+'\n';
      output+= "--------------------\n";
      output+= "Extraction\n";
      output+= "--------------------\n";
      output+= Blockly.JavaScript.extractPhase+'\n';
      output+= "--------------------\n";
      output+= "Transform\n";
      output+= "--------------------\n";
      output+= Blockly.JavaScript.translatePhase+'\n';
      output+= "--------------------\n";
      output+= "Store\n";
      output+= "--------------------\n";
      output+= Blockly.JavaScript.storePhase+'\n';
      output+= "--------------------\n";

      console.log(output)
    });
  </script>
</body>
</html>
